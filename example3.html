<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>jKanban サンプル (2)</title>
  <!-- jKanban の .css ファイルを読み込む -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jkanban@1.3.1/dist/jkanban.min.css">
  <!-- jKanban の .js ファイルを読み込む -->
  <script src="https://cdn.jsdelivr.net/npm/jkanban@1.3.1/dist/jkanban.min.js"></script>
  <style>
    /* カードの設定 */
    .kanban-item .text-red {
      color: crimson;
    }
    .kanban-item .text-bold {
      font-weight: bold;
    }
    .kanban-item.orange {
      color: white;
      background-color: darkorange;
    }
    .kanban-item .item-body img {
      width: 100%;
    }
    .kanban-item .item-body {
      max-height: 240px;
      overflow: hidden;
    }
    /* カラムのタイトルの色 */
    .kanban-board header {
      color: white;
      background-color: gray;
    }
    .kanban-board header.red {
      background-color: crimson;
    }
    .kanban-board header.blue {
      background-color: royalblue;
    }
    .kanban-board header.green {
      background-color: green;
    }
  </style>
</head>
<body>
  <div id="kanban-canvas">
    <!-- ここにカンバンが表示される -->
  </div>  
  <script>

    // カンバンに表示されるカラムやカードを定義
    const dataContent = [
      {
        "id"    : "column-id-1",
        "title" : "赤",
        "class": "red",
        "item"  : [
          {
            "id"      : "item-id-1",
            "title"   : "<span class='text-red text-bold'>カード 1</span>",
            "username": "hoge"
          },
          {
            "id"      : "item-id-2",
            "title"   : "カード 2",
            "class": "orange",
            "username": "piyo"
          }
        ]
      },
      {
        "id": "column-id-2",
        "title": "青",
        "class": "blue",
        "item": [
          {
            "id": "item-id-3",
            "title": "<div class='item-title'>カード 3</div><div class='item-body'><img src='https://i.imgur.com/b1dGytP.jpeg' /></div>"
          }
        ]
      },
      {
        "id": "column-id-3",
        "title": "緑",
        "class": "green",
        "item": [
          {
            "id": "item-id-4",
            "title": "カード 4"
          },
          {
            "id": "item-id-5",
            "title": "カード 5"
          }
        ]
      }
    ];

    // ここで jKanban を実行する
    const kanban = new jKanban({
      element: '#kanban-canvas',  // カンバンを表示する場所のID
      boards: dataContent,        // カンバンに表示されるカラムやカードのデータ
      gutter: '16px',             // カンバンの余白
      widthBoard: '250px',        // カラムの幅 (responsivePercentageの「true」設定により無視される)
      responsivePercentage: true, // trueを選択時はカラム幅は％で指定され、gutterとwidthBoardの設定は不要
      dragItems: true,            // trueを選択時はカードをドラッグ可能
      dragBoards: true,           // カラムをドラッグ可能にするかどうか

      // コールバック
      click: function (el) {
        // カードが左クリックされた時に実行
        onKanbanItemClicked(el);
      },
      context: function (el, event) {
        // カードが右クリックされた時に実行
      },
      dragEl: function (el, source) {
        // カードのドラッグが始まった時に実行
      },
      dragendEl: function (el) {
        // カードがドラッグが終わった時に実行
      },
      dropEl: function (el, target, source, sibling) {
        // カードがドロップされたときに実行
        onKanbanItemMoved(el, target, source, sibling);
      },
      dragBoard: function (el, source) {
        // カラムのドラッグを開始した時に実行
      },
      dragendBoard: function (el) {
        // カラムのドラッグが終わった時に実行
      },
      buttonClick: function(el, boardId) {
        // ボタンがクリックされた時に実行
      }
    });

    function onKanbanItemClicked(el) {
      alert(el.innerText + ' がクリックされました。');
    }

    function onKanbanItemMoved(el, target, source, sibling) {
      // 警告メッセージ
      var alertMsg = '';
      // 移動元カラムのタイトル
      var sourceTitle = source.parentNode.querySelector('header').innerText;
      // 移動元カラムのID
      var sourceId = source.parentNode.dataset.id;
      // 移動先カラムのタイトル
      var targetTitle = target.parentNode.querySelector('header').innerText;
      // 移動元カラムのID
      var targetId = target.parentNode.dataset.id;
      // 同じカラム内の移動か、それとも異なるカラム間の移動なのかを判別
      if (sourceId === targetId) {
        alertMsg = el.innerText + ' が ' + sourceTitle + ' のカラム内で移動しました。';
      } else {
        alertMsg = el.innerText + ' が ' + sourceTitle + ' から ' + targetTitle + ' へ移動しました。';
      }
      // メッセージを表示
      alert(alertMsg);
    }

    // カードに data-class= 属性が設定されていたら、
    // その値を取得してクラス名に追加する。
    document.querySelectorAll('.kanban-item').forEach(item => {
      if (item.dataset.class) {
        item.classList.add(item.dataset.class);
      }
    });

  </script>
</body>
</html>

